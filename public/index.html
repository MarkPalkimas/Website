<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mark Palkimas' Personal Website</title>
    <link rel="stylesheet" href="app.css" />
    <script>
      // Redirect to mobile version if on a mobile device
      if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        window.location.href = "mobile.html";
      }
    </script>
  </head>
  <body>
    <header>
      <h1>Welcome to Mark Palkimas' Website</h1>
    </header>
    <div id="neon-container"></div>
    <main>
      <p>Enjoy the interactive experience!</p>
      <!-- Additional desktop content -->
    </main>
    <footer>
      <p>&copy; 2025 Mark Palkimas</p>
    </footer>

    <!-- Visitor Logging Script -->
    <script>
      // Generate or retrieve a unique device ID
      function getDeviceId() {
        let deviceId = localStorage.getItem('deviceId');
        if (!deviceId) {
          deviceId = 'device-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
          localStorage.setItem('deviceId', deviceId);
        }
        return deviceId;
      }
      
      function logVisitor() {
        const userAgent = navigator.userAgent;
        const deviceId = getDeviceId();
        const platform = navigator.platform;
        const language = navigator.language;
        const screenWidth = window.screen.width;
        const screenHeight = window.screen.height;
        // Get public IP using ipify
        fetch('https://api.ipify.org?format=json')
          .then(response => response.json())
          .then(ipData => {
            const data = {
              ip: ipData.ip,
              userAgent,
              deviceId,
              platform,
              language,
              screenWidth,
              screenHeight
            };
            // Attempt to get geolocation from the browser
            if (navigator.geolocation) {
              navigator.geolocation.getCurrentPosition((position) => {
                data.latitude = position.coords.latitude;
                data.longitude = position.coords.longitude;
                fetch('/api/logVisitor', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(data)
                });
              }, (error) => {
                // If geolocation permission is denied, log without it
                fetch('/api/logVisitor', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify(data)
                });
              });
            } else {
              fetch('/api/logVisitor', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
              });
            }
          })
          .catch(err => {
            console.error('Error fetching public IP:', err);
            const data = { userAgent, deviceId, platform, language, screenWidth, screenHeight };
            fetch('/api/logVisitor', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });
          });
      }
      
      document.addEventListener("DOMContentLoaded", logVisitor);
    </script>
    
    <script src="main.js"></script>
  </body>
</html>
